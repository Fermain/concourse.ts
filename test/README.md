# Concourse.ts Testing Strategy

This document outlines the plan for running the existing test suite against the refactored TypeScript codebase.

## Goal

Validate the functionality of the `concourse.ts` library by running the original JavaScript tests (`test/**/*.spec.js`, `integration/**/*.spec.js`) against the compiled JavaScript output (`commonjs/`) with minimal changes to the test files themselves.

## Current Setup

*   **Test Runner:** Mocha
*   **Assertion Library:** Chai
*   **Mocking:** Sinon, axios-mock-adapter
*   **Test Files:** Located in `test/` and `integration/`, written in JavaScript (`.spec.js`).
*   **Source Code:** Located in `src/`, written in TypeScript (`.ts`).
*   **Compiled Output:** Located in `commonjs/`, generated by `tsc`.

## Proposed Strategy

1.  **Compile First:** Ensure the TypeScript code is compiled to JavaScript in `commonjs/` using `npm run build` before running tests.
2.  **Run Tests Against `commonjs/`:** Modify the `test` and `integration` scripts in `package.json` to configure Mocha to:
    *   Execute test files from the `test/` and `integration/` directories.
    *   Ensure that when tests import the library code (e.g., `import ConcourseClient from 'concourse.ts'`), it resolves to the compiled JavaScript output in the `commonjs/` directory. This might involve:
        *   Running tests with `NODE_PATH=./commonjs` environment variable.
        *   Using Mocha's `--require` flag to setup module path resolution.
        *   Potentially adjusting import paths within test files if direct relative paths (`../src/...`) were used (though this violates the "minimal test changes" goal).
3.  **Exclude `Fly.spec.js`:** The tests for the skipped `Fly.ts` client (`test/Fly.spec.js`) should be excluded from the test run, as the corresponding source file is excluded from the build.
4.  **Address Failures Iteratively:** Run the tests and systematically address any failures. Failures might arise from:
    *   Actual regressions introduced during refactoring.
    *   Subtle differences in the compiled JS output vs. the original JS.
    *   Changes in the API surface (e.g., method signatures, removal of model classes).
    *   Issues with how mocks interact with the compiled code.

## Next Steps

1.  Modify `package.json` test scripts (`test`, `integration`) to implement the proposed strategy (compile first, run mocha targeting `commonjs`, exclude `Fly.spec.js`).
2.  Run `npm run test`.
3.  Analyze and fix failures.
4.  Run `npm run integration`.
5.  Analyze and fix failures. 