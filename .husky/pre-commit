#!/usr/bin/env sh
set -ex

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep '\\.\(ts\|tsx\|js\|jsx\|json\|md\)$' || true)

echo "Staged files found for biome: $STAGED_FILES"

if [ -n "$STAGED_FILES" ]; then
  echo "Running npx biome check --write on staged files..."
  echo "$STAGED_FILES" | xargs npx biome check --write
  BIOME_EXIT_CODE=$?
  if [ $BIOME_EXIT_CODE -ne 0 ]; then
    echo "Biome check failed (Exit code: $BIOME_EXIT_CODE). Aborting commit."
    exit 1
  fi
  echo "Biome check passed."
  echo "Re-staging files modified by biome..."
  echo "$STAGED_FILES" | xargs git add
else
  echo "No relevant staged files found for biome check."
fi

echo "Skipping tests for now..."

echo "Pre-commit hook finished successfully."
exit 0 # Ensure script exits cleanly if tests are skipped
